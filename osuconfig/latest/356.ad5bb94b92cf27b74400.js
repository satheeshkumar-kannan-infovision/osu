"use strict";(self.webpackChunkosu_app=self.webpackChunkosu_app||[]).push([[356,975],{3356:(e,t,n)=>{n.d(t,{default:()=>N});var r=n(8168),a=n(467),s=n(4756),o=n.n(s),i=n(3870),u=n.n(i),l=n(1077),c=n(8499),m=n(3061),p=n(3361),f=n(1415),d=n.n(f),E=n(2096),y=n(3058),h=n(3182),g=n(4392),v=n(2488),k=n(7606),A=n(5380),C=n(710),x=["h2","body1","h2","body1"];function S(e){return u().createElement("div",null,x.map((function(t,n){return u().createElement(g.A,{component:"div",key:t+"_"+n,variant:t},e.loading?u().createElement(v.A,{height:"rect"==t?300:"auto"}):null)})))}function b(e){return u().createElement("div",{style:{width:"100%"}},u().createElement(k.A,{container:!0},u().createElement(k.A,{item:!0,md:!0},u().createElement(S,{loading:e.loading}))))}var w=(0,E.A)((function(e){return{backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"}}}));const N=function(e){e.children;var t=w(),n=(0,i.useState)([]),s=n[0],f=n[1],E=(0,i.useState)([]),g=E[0],v=E[1],k=(0,i.useState)([]),x=k[0],S=k[1],N=(0,i.useState)(!0),I=N[0],_=N[1],R=(0,i.useState)(!1),D=R[0],O=R[1],P=(0,i.useState)(!1),J=P[0],V=P[1],T=(0,i.useState)(!1),U=T[0],B=T[1],L=(0,i.useState)(!1),j=L[0],F=L[1],G=(0,i.useState)(!1),M=G[0],z=G[1],q=(0,i.useState)(null),H=q[0],K=q[1],Q=(0,i.useState)(null),W=Q[0],X=Q[1],Y=(0,i.useState)(!1),Z=Y[0],$=Y[1],ee=(0,i.useState)(null),te=ee[0],ne=ee[1],re=(0,i.useState)(!1),ae=re[0],se=re[1],oe=function(){var e=(0,a.A)(o().mark((function e(){var t,n,a,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return $(!1),O(!0),(t=JSON.parse(sessionStorage.getItem("userData"))).username,n=t.ephemeral_token,a={rollout:s.filter((function(e){return e.isChecked})).map((function(e){return(0,r.A)({},e,{percent:100})})),timestamp:H},e.prev=6,e.next=9,d().post("MISSING_ENV_VAR".API_URL+"/osu/rollout",a,{headers:{"x-api-key":n,"Content-Type":"application/json"}});case 9:i=e.sent,K(i.data.timestamp),S(i.data.firmwares),f(i.data.rollouts.map((function(e,t){return(0,r.A)({},e,{isExisting:!0})}))),v(i.data.rollouts.map((function(e,t){return(0,r.A)({},e,{isExisting:!0,isChecked:!1})}))),X({type:"success",message:"Canary config promoted successfully."}),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(6),console.error("Error:",e.t0),e.t0.response?X({type:"error",message:e.t0.response.data.error}):X({type:"error",message:JSON.stringify(e.t0)});case 21:return e.prev=21,O(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[6,17,21,24]])})));return function(){return e.apply(this,arguments)}}(),ie=function(){var e=(0,a.A)(o().mark((function e(){var t,n,a,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return $(!1),O(!0),(t=JSON.parse(sessionStorage.getItem("userData"))).username,n=t.ephemeral_token,a={rollout:s.filter((function(e){return e.isChecked&&e.isDirty&&e.percent>0})),timestamp:H},e.prev=6,e.next=9,d().post("MISSING_ENV_VAR".API_URL+"/osu/rollout",a,{headers:{"x-api-key":n,"Content-Type":"application/json"}});case 9:i=e.sent,K(i.data.timestamp),S(i.data.firmwares),f(i.data.rollouts.map((function(e,t){return(0,r.A)({},e,{isExisting:!0})}))),v(i.data.rollouts.map((function(e,t){return(0,r.A)({},e,{isExisting:!0,isChecked:!1})}))),X({type:"success",message:"Canary config updated successfully."}),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(6),console.error("Error:",e.t0),409===e.t0.response.status?(X({type:"error",message:"There's some changes happened before your update."}),setTimeout((function(){ue()}),5e3)):e.t0.response?console.error("Error:",e.t0.response.data.error):X({type:"error",message:JSON.stringify(e.t0)});case 21:return e.prev=21,O(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[6,17,21,24]])})));return function(){return e.apply(this,arguments)}}(),ue=function(){_(!0);var e=JSON.parse(sessionStorage.getItem("userData")).ephemeral_token;d().get("MISSING_ENV_VAR".API_URL+"/osu/rollout",{headers:{"x-api-key":e}}).then((function(e){0===e.data.firmwares.length&&0===e.data.rollouts.length&&se(!0),S(e.data.firmwares),0===e.data.firmwares.length?(f({version:"",percent:0,isExisting:!1}),v({version:"",percent:0,isExisting:!1})):(f(e.data.rollouts.map((function(e,t){return(0,r.A)({},e,{isExisting:!0})}))),v(e.data.rollouts.map((function(e,t){return(0,r.A)({},e,{isExisting:!0})})))),K(e.data.timestamp?e.data.timestamp:0),_(!1),X(null)})).catch((function(e){console.error("Error:",e),_(!1),X({type:"error",message:JSON.stringify(e)})})).finally((function(){_(!1)}))};return(0,i.useEffect)((function(){ue()}),[]),(0,i.useEffect)((function(){if(s.length>0){var e=s.some((function(e){return""!==e.version&&!0===e.isChecked&&!0===e.isDirty&&0!==parseInt(e.percent)}))&&!s.some((function(e){return(""===e.version||!e.isDirty||0===parseInt(e.percent))&&!0===e.isChecked}));V(e);var t=s.some((function(e){return""!==e.version&&!0===e.isChecked}))&&!s.some((function(e){return""===e.version&&!0===e.isChecked}));B(t);var n=x.length===s.length;F(n);var r=s.some((function(e){return!1===e.isExisting||!0===e.isDirty||!0===e.isChecked}));z(r)}}),[s]),u().createElement("div",null,u().createElement(l.A,{style:{paddingLeft:"10px"}}),u().createElement("div",{className:"container my-5"},ae&&u().createElement("h3",{style:{textAlign:"center"}},"No canary firmwares available"),W&&u().createElement(A.A,{type:W.type,message:W.message,setApiError:X,className:"my-3",variant:"filled"}),I?u().createElement(b,{loading:!0}):!ae&&u().createElement(u().Fragment,null,u().createElement(c.A,{allFirmwares:x,existingConfig:s,onRemove:function(e){var t=[].concat(s.slice(0,e),s.slice(e+1));f(t)},updateFirmware:function(e,t){f((function(n){return[].concat(n.slice(0,e),[t],n.slice(e+1))}))}}),u().createElement(m.A,{disabled:j,onClick:function(){f((function(e){return[].concat(e,[{version:"",percent:0,isExisting:!1}])}))}}),u().createElement(p.Row,{style:{justifyContent:"flex-end",marginTop:40}},u().createElement(p.Button,{disabled:!M,className:"mr-3",onClick:function(){f(g)}},"Reset Changes"),u().createElement(p.Button,{className:"mr-3",disabled:!U,onClick:function(e){var t=s.filter((function(e){return e.isChecked})).map((function(e){return e.version}));ne({type:"promote",text:u().createElement("span",null,"Are you sure you want to promote the canary of below firmwares?",u().createElement("br",null),u().createElement("b",null,t.map((function(e){return u().createElement("div",null,e,u().createElement("br",null))}))))}),$(!0)}},"Promote"),u().createElement(p.Button,{className:"mr-3",disabled:!U,onClick:function(e){var t=s.filter((function(e){return e.isChecked})).map((function(e){return e.version}));ne({type:"pause",text:u().createElement("span",null,"Are you sure you want to pause the canary of below firmwares?",u().createElement("br",null),u().createElement("b",null,t.map((function(e){return u().createElement("div",null,e,u().createElement("br",null))}))))}),$(!0)}},"Pause"),u().createElement(p.Button,{disabled:!J,onClick:function(){var e=s.filter((function(e){return e.isChecked})).map((function(e){return e.version}));ne({type:"update",text:u().createElement("span",null,"Are you sure you want to update the canary of below firmwares?",u().createElement("br",null),u().createElement("b",null,e.map((function(e){return u().createElement("div",null,e,u().createElement("br",null))}))))}),$(!0)}},"Update Rollout"))),D&&u().createElement("div",null,u().createElement(y.A,{className:t.backdrop,open:!0},u().createElement(h.A,null))),Z&&u().createElement(C.A,{title:function(){switch(null==te?void 0:te.type){case"update":return"Update Rollout Config";case"promote":return"Promote Canary";case"pause":return"Pause Canary";default:return"Confirm Action"}}(),text:u().createElement("span",null,te.text),isOpen:Z,loading:I,handleClose:function(){$(!1)},handleSubmit:function(){"update"===te.type?ie():oe()}})))}}}]);
//# sourceMappingURL=356.ad5bb94b92cf27b74400.js.map